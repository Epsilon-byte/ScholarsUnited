extends layout

block content
  .container
    .event-card
      h2.event-title
        = event.Title
        if event.status === 'cancelled'
          span.badge.bg-danger(style='margin-left: 10px') Cancelled

      .event-info
        p
          strong Date:
          | #{event.date} at #{event.time}

        p
          strong Location:
          | #{event.Location || 'Not specified'}

        p
          strong Description:
          | #{event.Description || 'No description available'}

      // ‚ùó Alert if event is cancelled
      if event.status === 'cancelled'
        div.alert.alert-warning.mt-3
          strong This event has been cancelled. Participation is no longer possible.

      // üë• Participants List
      if participants.length
        h3 Participants
        ul.participant-list
          each person in participants
            li= person.FullName
      else
        p.text-muted No participants yet.

      // ‚úÖ Conditional Join/Leave Buttons
      if event.status !== 'cancelled'
        if hasJoined
          form(action=`/events/leave/${event.EventID}` method="POST")
            button.btn.btn-outline-danger(type="submit" style="margin-top: 15px") Leave Event
        else
          form(action=`/events/join/${event.EventID}` method="POST")
            button.btn.btn-primary(type="submit" style="margin-top: 15px") Join Event
      else
        p.text-warning(style="margin-top: 15px") This event has been cancelled.

      // üîÅ Navigation Buttons
      .nav-buttons.mt-4
        a.btn.btn-secondary(href='/dashboard') ‚Üê Back to Dashboard
        a.btn.btn-secondary(href='/events') ‚Üê Back to Events

      // üîß Event Owner Actions
      if user && event.Created_By === user.id
        if event.status !== 'cancelled'
          form(method="POST", action=`/events/${event.EventID}/cancel`, onsubmit="return confirm('Are you sure you want to cancel this event?')")
            button.btn.btn-danger(type="submit" style="margin-top: 15px") Cancel Event

          form(method="GET", action=`/events/${event.EventID}/edit`, style="display:inline-block; margin-left:10px")
            button.btn.btn-warning(type="submit" style="margin-top: 15px") Reschedule
