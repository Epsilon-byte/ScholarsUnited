extends layout

block content
  .container
    section.main-content
      .course-box
        h1 Upcoming Events
        p Discover, join, or create exciting study events happening near you.

      .dashboard-box
        a(href='/events/create', class='btn btn-primary create-event-btn') + Create New Event

        if events && events.length
          .event-card-grid
            each event in events
              //- Dim style for cancelled events
              .event-card(class=event.status === 'cancelled' ? 'cancelled' : '')
                h2.event-title 
                  = event.Title
                  if event.status === 'cancelled'
                    span.badge.bg-danger(style='margin-left:10px') Cancelled

                .event-meta
                  p 📅 #{event.date || 'Date N/A'} at 🕒 #{event.time || 'Time N/A'}
                  p 📍 #{event.Location || 'Location N/A'}
                p.event-description= event.Description || 'No description available'

                .event-actions
                  a(href=`/events/${event.EventID}` class='btn-view') View Details

                  // ✅ Only show cancel/reschedule if user is creator
                  if user && event.Created_By === user.id && event.status !== 'cancelled'
                    form(method="POST", action=`/events/${event.EventID}/cancel`, onsubmit="return confirm('Are you sure you want to cancel this event?')")
                      button(type="submit" class="btn btn-danger btn-sm") Cancel Event

                    form(method="GET", action=`/events/${event.EventID}/edit`, style='display:inline-block; margin-left:5px')
                      button(type="submit" class="btn btn-warning btn-sm") Reschedule
        else
          p.no-events Sorry, no events are currently scheduled.
