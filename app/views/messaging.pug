extends layout

block content
  .messaging-container
    h1 Messages

    //  Check if there are messages
    if messages && messages.length
      ul
        each message in messages
          //  Define if the current user is the sender
          - const isSender = message.senderId === user.id;

          //  Conditional class: sender (align right) or receiver (align left)
          li(class=`message-wrapper ${isSender ? 'sender' : 'receiver'}`)
            .message-item
              // ğŸ‘¤ Sender name in blue-green
              span.message-sender
                | ğŸ‘¤ Sender:
                strong(style="color: #00675b") #{message.sender} (ID: #{message.senderId})

              br

              // ğŸ‘¥ Receiver name in dark gray
              span.message-receiver
                | ğŸ‘¥ Receiver:
                strong(style="color: #555") #{message.receiver} (ID: #{message.receiverId})

              //  Message content and timestamp
              p #{message.content}
              small Sent: #{message.timestamp}

              //  Show delete/edit buttons only if current user is the sender
              if isSender
                form(action=`/messages/delete/${message.messageId}`, method="POST")
                  button(type="submit") ğŸ”’ Delete

                form(action=`/messages/update/${message.messageId}`, method="POST")
                  input(type="text", name="newContent", placeholder="Edit message", required)
                  button(type="submit") ğŸ–‰ Save and Resend Edit Messages
    else
      p No messages available. Please send a message to start a conversation.
      p You can send a message to any user by entering their User ID. 
    

    //  Message send form
    h2 Send a Message
      form(action='/messages/send', method='POST')
        label(for='receiverId') To (User ID):
        input(
          type='text', 
          name='receiverId', 
          id='receiverId',
          value=receiverId || '',
          required,
          readonly=receiverId ? true : false
        )
        
        if receiverName
          span (#{receiverName})

        label(for='content') Message:
        textarea(name='content', id='content', required)

        button(type='submit') ğŸ“¨ Send Message
